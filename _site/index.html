<!DOCTYPE html>
<html>
  <head>
    <title>mister-pokeylope</title>
    <link rel="stylesheet" type="text/css" href="/css/main.css">
    <link rel="stylesheet" type="text/css" href="/css/syntax.css">
    <meta charset="UTF-8"> 
  </head>
  <body>
    <nav>
      <div class="wrapper">
        <h3>mister-pokeylope</h3>
        <ul class="menu">
          <li class="nav-item">
            
              <a class="nav-link-current" href="/">Home</a>
            
          </li>
          <li class="nav-item">
            
              <a class="nav-link" href="/about/">About</a>
            
          </li>
          <li class="nav-item">
            
              <a class="nav-link" href="/contact/">Contact</a>
            
          </li>
          <li class="nav-item">
            
              <a class="nav-link" href="/archive/">Archives</a>
            
          </li>
        </ul>
      </div>
    </nav> 
            
    <br>
    <section>
  <div class="wrapper">
    <h1>Blog Posts</h1>
    
      <div class="line-separator"></div>
      <article>
        <h2>09 May 2014 &raquo; Configuring iptables</h2>
        <div class="post">
          <p>With the recent fixing of my &quot;network issues&quot;, I have been putting more time
and effort in to making sure everything, from the website to the Raspberry Pi,
is cleaned out after it&#39;s Winter hibernation. Upon reading some of journald&#39;s
log files (which I&#39;d noticed grew somewhat quickly), I discovered a flood of
failed remote login attempts, clustered at different times of the day, and all
attempting to login from high numbered ports, with users that don&#39;t exist on the
system. A quick <code>whois</code> lookup on the IPs revealed that they&#39;re locations from 
all over the world, so most likely bots looking for easy access to insecure 
systems.</p>

<p>Before the downtime I had not bothered to setup any sort of protection on the
Pi since I figured that my domain was still relatively new and unknown. While
it&#39;s still pretty unkown, I have it posted in public places now, and have it
indexed by Google, so this most likely allows intrepid spam-bots to find my
domain relatively easily. While programs like <a href="http://www.fail2ban.org/wiki/index.php/Main_Page">fail2ban</a> or disabling
ssh all together could have remedied the problem, I went for a much less
passive approach, and decided to set up a firewall.</p>

<p>Linux has plenty of software firewall solutions, but naturally I decided to go 
with <a href="http://en.wikipedia.org/wiki/Iptables">iptables</a>, the Linux kernel&#39;s built-in firewall. I&#39;m fully
aware of <a href="https://wiki.archlinux.org/index.php/Nftables">nftables</a>, the sucessor to iptables, but since Arch Linux
ARM currently has the 3.10 Kernel as it&#39;s &quot;stable&quot; Kernel version this option 
is not available to me yet. I plan on using it however, once it fully 
replaces iptables in the kernel.</p>

<p>While it&#39;s a powerful tool, iptables is not the easiest to setup for those
inexperienced with firewalls, like me. Fortunately the fantastic Arch Wiki has
<a href="https://wiki.archlinux.org/index.php/Simple_stateful_firewall">an entire article for setting up a stateful firewall</a> with iptables. </p>

<p>Admittedly it didn&#39;t go as smoothly as I thought it would, entirely due to
PEBKAC issues, and setting it up over an ssh connection. As one could
imagine setting the <code>INPUT DROP</code> policy before configuring the SSH
related chain will quickly lead to an unproductive session, especially when one
doesn&#39;t have immediate physical access to the Raspberry Pi.</p>

<p>Luckily for me the article in question has a helpful explination of what each
command did at each step, so at least I wouldn&#39;t feel too bad about the fact 
I mainly copy and pasted the commands that I felt I needed. While I still don&#39;t
know a significant amount about iptables yet, I feel I now at least have a 
basic understanding, that suits a machine that only servers out a simple 
webserver.</p>

<p>For those interested, I threw together a quick bash script that more or less 
matches the rules and chains I have in place. This must be run as root, so 
<em>use with caution</em>.</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c">#!/usr/bin/bash</span>

<span class="c"># User defined chains</span>
<span class="nb">echo</span> <span class="s2">&quot;Setting user defined Chains&quot;</span>
iptables -N TCP
iptables -N UDP
<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>

<span class="c"># Set default policies</span>
<span class="nb">echo</span> <span class="s2">&quot;Setting Policies&quot;</span>
iptables -P FORWARD DROP
iptables -P OUTPUT ACCEPT
<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>

<span class="c"># Set rules</span>
<span class="nb">echo</span> <span class="s2">&quot;Setting rules&quot;</span>
iptables -A INPUT -m conntrack --ctstate RELATED,ESTABLISHED -j ACCEPT
iptables -A INPUT -i lo -j ACCEPT
iptables -A INPUT -m conntrack --ctstate INVALID -j DROP
iptables -A INPUT -p icmp --icmp-type 8 -m conntrack --ctstate NEW -j ACCEPT
<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>

<span class="c"># Attach TCP/UDP chains to INPUT</span>
<span class="nb">echo</span> <span class="s2">&quot;Attaching TCP/UDP chains to INPUT&quot;</span>
iptables -A INPUT -p udp -m conntrack --ctstate NEW -j UDP
iptables -A INPUT -p tcp --syn -m conntrack --ctstate NEW -j TCP
<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>

<span class="c"># Open ports for services</span>
<span class="nb">echo</span> <span class="s2">&quot;Opening ports for HTTP, HTTPS, DNS, and SSH&quot;</span>
iptables -A TCP -p tcp --dport 80 -j ACCEPT
iptables -A TCP -p tcp --dport 443 -j ACCEPT
iptables -A UDP -p udp --dport 53 -j ACCEPT
iptables -A TCP -p tcp --dport 22 -j ACCEPT
<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>

<span class="c"># Reject everything else</span>
iptables -P INPUT DROP

<span class="c"># Save Settings</span>
<span class="nb">echo</span> <span class="s2">&quot;Saving settings to /etc/iptables/iptables.rules&quot;</span>
iptables-save /etc/iptables/iptables.rules
<span class="nb">echo</span> <span class="s2">&quot;Done&quot;</span>
</code></pre></div>
<p>Of course, there is more I can do, such as disabling logins for SSH, and only
allowing access via SSH keys. That being said, there&#39;s nothing particularly
interesting/useful/valuable on my Raspberry Pi in the first place.</p>

          <a href="/posts/linux/2014/05/09/iptables/">permalink</a>
        </div>
      </article>
    
      <div class="line-separator"></div>
      <article>
        <h2>04 May 2014 &raquo; IT LIVES!</h2>
        <div class="post">
          <p>About four months ago we got fed up with how hit or miss
our WOW! provided router was, and replaced the wireless functions of
the offending Router/Modem abomination with a real wireless router. Somehow the
port forwarding and DHCP reservations for my Pi were disrupted, and
my website went down. Due to how busy this recent semester
at school was, I didn&#39;t have much time/energy (except I kinda did sometimes) to deal
with getting it back up and running. Since I had a bit of free time between
Spring and Summer semester (almost an entire week!), I didn&#39;t have much of an
excuse to not deal with it.</p>

<p>Fortunately my four-month-out-of-date Arch Linux ARM install survived the most
massive system update it will hopefully ever have to deal with, and other
than not having enough space the first try due to an unemptied Pacman cache,
it&#39;s up and running, happy as can be.</p>

<p>Despite broken promises of real content and what not, I will still try to put
some stuff out every now and then, even though my final two semesters at school
are looking to be just as busy as my most recent ones.</p>

          <a href="/posts/site/2014/05/04/it-lives/">permalink</a>
        </div>
      </article>
    
      <div class="line-separator"></div>
      <article>
        <h2>02 Jan 2014 &raquo; New Year, Hopefully New Content</h2>
        <div class="post">
          <p>Hopefully in the coming year I am able/willing to make more posts with
content more interesting content than changes I made to the internals of this blog.
However, I&#39;ve reached a plateau in terms of changes I want to make, so there
isn&#39;t much more I can even post about it. Recently I&#39;ve embedded Mozilla&#39;s <a href="http://mozilla.github.io/Fira/">Fira
Typeface</a> in place of the user&#39;s predefined font. It should show up just
fine on Firefox and webkit browsers, but I have no idea about Internet Explorer other than IE11, 
or others. Just in case there are other pleasant fallbacks in place. The site may
load a bit slower now since it has to load the fonts, but it shouldn&#39;t be too
noticable.</p>

<p>The favicon is a new addition as well. It&#39;s nothing special, but the extremely
observant reader would have noticed that the letters &#39;m&#39; and &#39;p&#39; were made using
the Mr. Saturn font from the game Earthbound (a personal favorite of mine)!</p>

<p><img src="/img/saturnboing.png" alt="boing"></p>

<p>(font and image courtesy of <a href="http://earthboundcentral.com/2009/11/ultimate-earthbound-font-pack/">Earthbound Central</a>)</p>

          <a href="/posts/site/2014/01/02/new-year/">permalink</a>
        </div>
      </article>
    
      <div class="line-separator"></div>
      <article>
        <h2>16 Dec 2013 &raquo; New Name! Same Great Taste!</h2>
        <div class="post">
          <p>Earlier today I finally bit the proverbial bullet and purchased a domain for
this site. I now own the misterpokeylope.com domain, and will be using
it instead of the old mrpokeylope.mooo.com. I set up a redirect from the old 
URL to the new one and such, but at this point it&#39;s deprecated.</p>

<p>All of the dynamic DNS services are still provided by FreeDNS, and everything is
still hosted on my Raspberry Pi, so absolutely nothing has changed other than
the URL. Recently I discovered that my website could not be indexed by Google or
other search engines due to the polices of using a free shared subdomain from FreeDNS. 
So now, the hope is that people will actually be able to find this site 
without me having to give a link out...</p>

<p>$15 well spent I suppose.</p>

          <a href="/posts/site/2013/12/16/new-name/">permalink</a>
        </div>
      </article>
    
      <div class="line-separator"></div>
      <article>
        <h2>12 Dec 2013 &raquo; Comments and Pagination</h2>
        <div class="post">
          <p>Now that I&#39;ve done further, most likely unnoticable, refinements to this site,
I have been tossing the idea around of adding a comments section to each of the
permalinked posts. There seem to be a fair number of static comment plugins
already available, so it sounds like it would be brain dead easy to add something
simple in. I&#39;m going to avoid complicated things like Disqus since it seems
like overkill for the &quot;whopping amount&quot; of traffic this website generates. I
will continue looking into more static solutions, since it would make it harder
for this place to just become a nest for spam bots.</p>

<p>In other news I&#39;ve implemented/fixed pagination for this site, using Jekyll&#39;s built in 
pagination. I&#39;ve technically had the code there the whole time, but since I had less than 
5 posts up until now, it didn&#39;t do anything. It was broken anyways due to <code>previous</code>
looking for <code>page1/</code>, which is not generated by my configuration. All that was
needed was an addition if-else clause with Liquid, and everything works as
intended. It&#39;s such a simple fix that I don&#39;t even know why Jekyll includes <a href="http://jekyllrb.com/docs/pagination/#render_the_paginated_posts">the
broken example</a> on their page.</p>

<p>For the curious out there, here&#39;s my version:</p>

<p><code>index.html</code></p>
<div class="highlight"><pre><code class="html language-html" data-lang="html"><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;pagination&quot;</span><span class="nt">&gt;</span>
  {% if paginator.previous_page %}
    {% if paginator.previous_page == 1 %}
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/&quot;</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/a&gt;</span>
    {% else %}
      <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;page{{ paginator.previous_page }}&quot;</span><span class="nt">&gt;</span>Previous<span class="nt">&lt;/a&gt;</span>
    {% endif %}
  {% else %}
    <span class="nt">&lt;span&gt;</span>Previous<span class="nt">&lt;/span&gt;</span>
  {% endif %}
  <span class="nt">&lt;span&gt;</span>Page: {{ paginator.page }} of {{ paginator.total_pages }}<span class="nt">&lt;/span&gt;</span>
  {% if paginator.next_page %}
    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;page{{ paginator.next_page }}&quot;</span><span class="nt">&gt;</span>Next<span class="nt">&lt;/a&gt;</span>
  {% else %}
    <span class="nt">&lt;span&gt;</span>Next<span class="nt">&lt;/span&gt;</span>
  {% endif %}
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>
<p>And that&#39;s really all it takes. I also tried the overly complicated fix they
have listed below, and fought with it far more than I should have (as in I had
to fight with it at all), and just settled on my slight modification instead.
Sure, I could have had links to multiple pages instead of just having &quot;next&quot;
and &quot;previous&quot;, but who cares? That&#39;s what the <a href="/archive">archives</a> are for!</p>

          <a href="/posts/site/2013/12/12/comments-and-pages/">permalink</a>
        </div>
      </article>
    

    <div class="line-separator"></div>

      <!-- Pagination links -->
    <div class="post">
      
      <span class="page_number ">Page: 1 
          of 2</span>
      
        <a href="page2" class="next">Next</a>
      
    </div>
  </div>
</section>
  
    <br>

    <footer>
      <div class="wrapper">
        <a href="http://www.w3.org/html/logo/" class="logo" 
            target="_blank">
          <img src="/html5-badge.png" width="165" height="64" 
          alt="HTML5 Powered with CSS3 / Styling, and Semantics" 
          title="HTML5 Powered with CSS3 / Styling, and Semantics">
        </a>
        <p class="foot">
          My intent is to keep this website HTML5 and CSS3
          compliant. All code has been validated with the <a  
          href="http://validator.w3.org/check?uri=http%3A%2F%2Fwww.misterpokeylope.com%2F" 
          target="_blank"> W3C Markup Validation Service</a> and the <a 
          href="http://jigsaw.w3.org/css-validator/validator?uri=www.misterpokeylope.com"
          target="_blank">W3 CSS Validation Service</a>. 
          CSS(3) vendor prefixes are used where available, with
          priortity given to Firefox and WebKit compatibility.
          Full and constant compatibility across all browers is not guaranteed. 
          <br>
          DNS services provided by <a href="http://freedns.afraid.org/" 
              target="_blank">FreeDNS</a>. Powered by <a href="http://nginx.org/" 
              target="_blank">nginx</a>. Built using <a
              href="http://jekyllrb.com/" target="_blank">Jekyll</a>.
        </p>
      </div>
    </footer>
  </body>
</html>
